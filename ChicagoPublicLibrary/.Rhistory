library(ggplot2)
library(maps)
library(scales)
library(gridExtra)
setwd("D:/Freelance Work/Database_Work/LibraryDataAnalysis/ChicagoPublicLibrary")
seabornPalette <- c("#4c72b0","#55a868","#c44e52","#8172b2","#ccb974","#64b5cd","#4c72b0","#55a868","#c44e52","#8172b2",
"#ccb974","#64b5cd","#4c72b0","#55a868","#c44e52","#8172b2","#ccb974","#64b5cd","#4c72b0","#55a868",
"#c44e52","#8172b2","#ccb974","#64b5cd","#4c72b0","#55a868","#c44e52","#8172b2","#ccb974","#64b5cd",
"#4c72b0","#55a868","#c44e52","#8172b2","#ccb974","#64b5cd","#4c72b0","#55a868","#c44e52","#8172b2",
"#ccb974","#64b5cd","#4c72b0","#55a868","#c44e52","#8172b2","#ccb974","#64b5cd","#4c72b0","#55a868",
"#c44e52","#8172b2","#ccb974","#64b5cd","#4c72b0","#55a868","#c44e52","#8172b2","#ccb974","#64b5cd")
##############################
## PLOT GENERATION
##############################
outputPlot <- function(objPlot, strfile){
ppi <- 300
png(paste0("Libraries/_System/", strfile), width=8.5, height=11, units="in", res=ppi)
print(objPlot)
dev.off()
}
# MAP GRAPHS
LocData <- readRDS("DATA/ChicagoLocationData.rds")
LocData$LOCATION <- ifelse(grepl("Harold Washington", LocData$LOCATION), "Harold Washington Library Center", LocData$LOCATION)
LocData <- merge(LocData, LibData, by="LOCATION", all=TRUE)
# AGGREGATE DATA FRAME
aggdf <- aggregate(.~LOCATION + LAT + LON + YEAR,
data=LocData[c("LOCATION", "LAT", "LON", "YEAR", "CIRCULATION", "HOLDS", "COMPUTER", "VISITORS")], FUN=mean)
aggdf$LAT <- as.numeric(aggdf$LAT)
aggdf$LON <- as.numeric(aggdf$LON)
aggdf$YEAR <- as.factor(as.character(aggdf$YEAR))
# NEIGHBORHOOD BORDERS
neighData <- read.csv("DATA/ChicagoNeighborhoods.csv", stringsAsFactors = FALSE)
commAreasData <- read.csv("DATA/CommAreas.csv", stringsAsFactors = FALSE)
test <- strsplit(gsub(")))", "", gsub("MULTIPOLYGON \\(\\(\\(", "", neighData$the_geom[[98]])), split="\\s+")
test$LON <- as.numeric(test[[1]][seq(1, length(test[[1]]), 2)])
test$LAT <- as.numeric(gsub(",", "", test[[1]][seq(2, length(test[[1]]), 2)]))
testdf <- data.frame(neighborhood=1, LON=test$LON, LAT=test$LAT)
neighdf <- do.call(rbind, Map(function(p, g, m) {
temp <- strsplit(gsub(")))", "", gsub("MULTIPOLYGON \\(\\(\\(", "", g)), split="\\s+")
data.frame(neighborhood = p,
neighgrp = m,
LON = as.numeric(temp[[1]][seq(1, length(temp[[1]]), 2)]),
LAT = as.numeric(gsub(",", "", temp[[1]][seq(2, length(temp[[1]]), 2)])))
}, neighData$PRI_NEIGH, neighData$the_geom, seq(98)))
rownames(neighdf) <- NULL
LibData <- readRDS("DATA/ChicagoLibData.rds")
# MAP GRAPHS
LocData <- readRDS("DATA/ChicagoLocationData.rds")
LocData$LOCATION <- ifelse(grepl("Harold Washington", LocData$LOCATION), "Harold Washington Library Center", LocData$LOCATION)
LocData <- merge(LocData, LibData, by="LOCATION", all=TRUE)
# AGGREGATE DATA FRAME
aggdf <- aggregate(.~LOCATION + LAT + LON + YEAR,
data=LocData[c("LOCATION", "LAT", "LON", "YEAR", "CIRCULATION", "HOLDS", "COMPUTER", "VISITORS")], FUN=mean)
aggdf$LAT <- as.numeric(aggdf$LAT)
aggdf$LON <- as.numeric(aggdf$LON)
aggdf$YEAR <- as.factor(as.character(aggdf$YEAR))
# NEIGHBORHOOD BORDERS
neighData <- read.csv("DATA/ChicagoNeighborhoods.csv", stringsAsFactors = FALSE)
test <- strsplit(gsub(")))", "", gsub("MULTIPOLYGON \\(\\(\\(", "", neighData$the_geom[[98]])), split="\\s+")
test$LON <- as.numeric(test[[1]][seq(1, length(test[[1]]), 2)])
test$LAT <- as.numeric(gsub(",", "", test[[1]][seq(2, length(test[[1]]), 2)]))
testdf <- data.frame(neighborhood=1, LON=test$LON, LAT=test$LAT)
neighdf <- do.call(rbind, Map(function(p, g, m) {
temp <- strsplit(gsub(")))", "", gsub("MULTIPOLYGON \\(\\(\\(", "", g)), split="\\s+")
data.frame(neighborhood = p,
neighgrp = m,
LON = as.numeric(temp[[1]][seq(1, length(temp[[1]]), 2)]),
LAT = as.numeric(gsub(",", "", temp[[1]][seq(2, length(temp[[1]]), 2)])))
}, neighData$PRI_NEIGH, neighData$the_geom, seq(98)))
rownames(neighdf) <- NULL
neighData <- read.csv("DATA/ChicagoNeighborhoods.csv", stringsAsFactors = FALSE)
neighdf <- do.call(rbind, Map(function(p, g, m) {
temp <- strsplit(gsub(")))", "", gsub("MULTIPOLYGON \\(\\(\\(", "", g)), split="\\s+")
data.frame(neighborhood = p,
neighgrp = m,
LON = as.numeric(temp[[1]][seq(1, length(temp[[1]]), 2)]),
LAT = as.numeric(gsub(",", "", temp[[1]][seq(2, length(temp[[1]]), 2)])))
}, neighData$PRI_NEIGH, neighData$the_geom, seq(nrow(neighData))))
rownames(neighdf) <- NULL
nrow(neighData$PRI_NEIGH)
nrow(neighData)
length(neighData$PRI_NEIGH)
rm(neighData)
neighdf <- do.call(rbind, Map(function(p, g, m) {
temp <- strsplit(gsub(")))", "", gsub("MULTIPOLYGON \\(\\(\\(", "", g)), split="\\s+")
data.frame(neighborhood = p,
neighgrp = m,
LON = as.numeric(temp[[1]][seq(1, length(temp[[1]]), 2)]),
LAT = as.numeric(gsub(",", "", temp[[1]][seq(2, length(temp[[1]]), 2)])))
}, neighData$PRI_NEIGH, neighData$the_geom, seq(nrow(neighData))))
rownames(neighdf) <- NULL
neighData <- read.csv("DATA/ChicagoNeighborhoods.csv", stringsAsFactors = FALSE)
neighdf <- do.call(rbind, Map(function(p, g, m) {
temp <- strsplit(gsub(")))", "", gsub("MULTIPOLYGON \\(\\(\\(", "", g)), split="\\s+")
data.frame(neighborhood = p,
neighgrp = m,
LON = as.numeric(temp[[1]][seq(1, length(temp[[1]]), 2)]),
LAT = as.numeric(gsub(",", "", temp[[1]][seq(2, length(temp[[1]]), 2)])))
}, neighData$PRI_NEIGH, neighData$the_geom, seq(nrow(neighData))))
rownames(neighdf) <- NULL
neighData <- read.csv("DATA/ChicagoNeighborhoods.csv", stringsAsFactors = FALSE)
neighdf <- do.call(rbind, Map(function(p, g, m) {
temp <- strsplit(gsub(")))", "", gsub("MULTIPOLYGON \\(\\(\\(", "", g)), split="\\s+")
data.frame(neighborhood = p,
neighgrp = m,
LON = as.numeric(temp[[1]][seq(1, length(temp[[1]]), 2)]),
LAT = as.numeric(gsub(",", "", temp[[1]][seq(2, length(temp[[1]]), 2)])))
}, neighData$PRI_NEIGH, neighData$the_geom, seq(nrow(neighData))))
rownames(neighdf) <- NULL
neighData <- read.csv("DATA/ChicagoNeighborhoods.csv", stringsAsFactors = FALSE)
neighdf <- do.call(rbind, Map(function(p, g, m) {
temp <- strsplit(gsub(")))", "", gsub("MULTIPOLYGON \\(\\(\\(", "", g)), split="\\s+")
data.frame(neighborhood = p,
neighgrp = m,
LON = as.numeric(temp[[1]][seq(1, length(temp[[1]]), 2)]),
LAT = as.numeric(gsub(",", "", temp[[1]][seq(2, length(temp[[1]]), 2)])))
}, neighData$PRI_NEIGH, neighData$the_geom, seq(nrow(neighData))))
rownames(neighdf) <- NULL
# HOLDS GEO PLOT
geoplots <- grid.arrange(
ggplot() +
geom_polygon(data=subset(map_data("state"), region=="illinois"), aes(x=long, y=lat, group=group),colour="white", fill="#ccb974" ) +
geom_polygon(data=neighdf, aes(x=LON, y=LAT, group=neighborhood), colour="white", fill="grey10" ) +
coord_map(xlim = c(-87.9, -87.5),ylim = c(41.65, 42.03)) +
geom_point(data=aggdf, aes(x=LON, y=LAT, size = as.numeric(HOLDS)), color="#c44e52") +
geom_text(data=aggdf, hjust=0.5, vjust=-0.5, aes(x=LON, y=LAT, label=LOCATION), colour="steelblue4", size=3) +
scale_size(name="Holds", label=comma) +
labs(title="Chicago Libraries Holds by Geography", x="Longitude", y="Latitude") +
theme(plot.title = element_text(size=16))
)
ggsave(file="Libraries/_System/GeoMapHolds.png", geoplots, height=11, width=8.5, units="in")
# HOLDS GEO PLOT
geoplots <- grid.arrange(
ggplot() +
geom_polygon(data=subset(map_data("state"), region=="illinois"), aes(x=long, y=lat, group=group),colour="white", fill="#8172b2" ) +
geom_polygon(data=neighdf, aes(x=LON, y=LAT, group=neighborhood), colour="white", fill="#8172b2" ) +
coord_map(xlim = c(-87.9, -87.5),ylim = c(41.65, 42.03)) +
geom_point(data=aggdf, aes(x=LON, y=LAT, size = as.numeric(HOLDS)), color="#c44e52") +
geom_text(data=aggdf, hjust=0.5, vjust=-0.5, aes(x=LON, y=LAT, label=LOCATION), colour="steelblue4", size=3) +
scale_size(name="Holds", label=comma) +
labs(title="Chicago Libraries Holds by Geography", x="Longitude", y="Latitude") +
theme(plot.title = element_text(size=16))
)
ggsave(file="Libraries/_System/GeoMapHolds.png", geoplots, height=11, width=8.5, units="in")
# HOLDS GEO PLOT
geoplots <- grid.arrange(
ggplot() +
geom_polygon(data=subset(map_data("state"), region=="illinois"), aes(x=long, y=lat, group=group),colour="white", fill="#64b5cd" ) +
geom_polygon(data=neighdf, aes(x=LON, y=LAT, group=neighborhood), colour="white", fill="#8172b2" ) +
coord_map(xlim = c(-87.9, -87.5),ylim = c(41.65, 42.03)) +
geom_point(data=aggdf, aes(x=LON, y=LAT, size = as.numeric(HOLDS)), color="#64b5cd") +
geom_text(data=aggdf, hjust=0.5, vjust=-0.5, aes(x=LON, y=LAT, label=LOCATION), colour="steelblue4", size=3) +
scale_size(name="Holds", label=comma) +
labs(title="Chicago Libraries Holds by Geography", x="Longitude", y="Latitude") +
theme(plot.title = element_text(size=16))
)
# HOLDS GEO PLOT
geoplots <- grid.arrange(
ggplot() +
geom_polygon(data=subset(map_data("state"), region=="illinois"), aes(x=long, y=lat, group=group),colour="white", fill="#64b5cd" ) +
geom_polygon(data=neighdf, aes(x=LON, y=LAT, group=neighborhood), colour="white", fill="#64b5cd" ) +
coord_map(xlim = c(-87.9, -87.5),ylim = c(41.65, 42.03)) +
geom_point(data=aggdf, aes(x=LON, y=LAT, size = as.numeric(HOLDS)), color="#c44e52") +
geom_text(data=aggdf, hjust=0.5, vjust=-0.5, aes(x=LON, y=LAT, label=LOCATION), colour="steelblue4", size=3) +
scale_size(name="Holds", label=comma) +
labs(title="Chicago Libraries Holds by Geography", x="Longitude", y="Latitude") +
theme(plot.title = element_text(size=16))
)
ggsave(file="Libraries/_System/GeoMapHolds.png", geoplots, height=11, width=8.5, units="in")
geoplots <- grid.arrange(
ggplot() +
geom_polygon(data=subset(map_data("state"), region=="illinois"), aes(x=long, y=lat, group=group),colour="white", fill="#64b5cd" ) +
geom_polygon(data=neighdf, aes(x=LON, y=LAT, group=neighborhood), colour="white", fill="#64b5cd" ) +
coord_map(xlim = c(-87.9, -87.5),ylim = c(41.65, 42.03)) +
geom_point(data=aggdf, aes(x=LON, y=LAT, size = as.numeric(CIRCULATION)), color="#c44e52") +
geom_text(data=aggdf, hjust=0.5, vjust=-0.5, aes(x=LON, y=LAT, label=LOCATION), colour="darkblue", size=3) +
scale_size(name="Circulation", label=comma) +
labs(title="Chicago Libraries Circulation by Geography", x="Longitude", y="Latitude") +
theme(plot.title = element_text(size=16))
)
ggsave(file="Libraries/_System/GeoMapCirculation.png", geoplots, height=11, width=8.5, units="in")
# CIRCULATION GEO PLOT
geoplots <- grid.arrange(
ggplot() +
geom_polygon(data=subset(map_data("state"), region=="illinois"), aes(x=long, y=lat, group=group),colour="white", fill="#64b5cd" ) +
geom_polygon(data=neighdf, aes(x=LON, y=LAT, group=neighborhood), colour="white", fill="#64b5cd" ) +
coord_map(xlim = c(-87.9, -87.5),ylim = c(41.65, 42.03)) +
geom_point(data=aggdf, aes(x=LON, y=LAT, size = as.numeric(CIRCULATION)), color="#c44e52") +
geom_text(data=aggdf, hjust=0.5, vjust=-0.5, aes(x=LON, y=LAT, label=LOCATION), colour="steelblue4", size=3) +
scale_size(name="Circulation", label=comma) +
labs(title="Chicago Libraries Circulation by Geography", x="Longitude", y="Latitude") +
theme(plot.title = element_text(size=16))
)
ggsave(file="Libraries/_System/GeoMapCirculation.png", geoplots, height=11, width=8.5, units="in")
# VISITORS GEO PLOT
geoplots <- grid.arrange(
ggplot() +
geom_polygon(data=subset(map_data("state"), region=="illinois"), aes(x=long, y=lat, group=group),colour="white", fill="#64b5cd" ) +
geom_polygon(data=neighdf, aes(x=LON, y=LAT, group=neighborhood), colour="white", fill="#64b5cd" ) +
coord_map(xlim = c(-87.9, -87.5),ylim = c(41.65, 42.03)) +
geom_point(data=aggdf, aes(x=LON, y=LAT, size = as.numeric(VISITORS)), color="#c44e52") +
geom_text(data=aggdf, hjust=0.5, vjust=-0.5, aes(x=LON, y=LAT, label=LOCATION), colour="steelblue4", size=3) +
scale_size(name="Visitors", label=comma) +
labs(title="Chicago Libraries Visitors by Geography", x="Longitude", y="Latitude") +
theme(plot.title = element_text(size=16))
)
ggsave(file="Libraries/_System/GeoMapVisitors.png", geoplots, height=11, width=8.5, units="in")
# HOLDS GEO PLOT
geoplots <- grid.arrange(
ggplot() +
geom_polygon(data=subset(map_data("state"), region=="illinois"), aes(x=long, y=lat, group=group),colour="white", fill="#64b5cd" ) +
geom_polygon(data=neighdf, aes(x=LON, y=LAT, group=neighborhood), colour="white", fill="#64b5cd" ) +
coord_map(xlim = c(-87.9, -87.5),ylim = c(41.65, 42.03)) +
geom_point(data=aggdf, aes(x=LON, y=LAT, size = as.numeric(HOLDS)), color="#c44e52") +
geom_text(data=aggdf, hjust=0.5, vjust=-0.5, aes(x=LON, y=LAT, label=LOCATION), colour="steelblue4", size=3) +
scale_size(name="Holds", label=comma) +
labs(title="Chicago Libraries Holds by Geography", x="Longitude", y="Latitude") +
theme(plot.title = element_text(size=16))
)
ggsave(file="Libraries/_System/GeoMapHolds.png", geoplots, height=11, width=8.5, units="in")
# COMPUTER GEO PLOT
geoplots <- grid.arrange(
ggplot() +
geom_polygon(data=subset(map_data("state"), region=="illinois"), aes(x=long, y=lat, group=group),colour="white", fill="#64b5cd" ) +
geom_polygon(data=neighdf, aes(x=LON, y=LAT, group=neighborhood), colour="white", fill="#64b5cd" ) +
coord_map(xlim = c(-87.9, -87.5),ylim = c(41.65, 42.03)) +
geom_point(data=aggdf, aes(x=LON, y=LAT, size = as.numeric(COMPUTER)), color="#c44e52") +
geom_text(data=aggdf, hjust=0.5, vjust=-0.5, aes(x=LON, y=LAT, label=LOCATION), colour="steelblue4", size=3) +
scale_size(name="CPU Sessions", label=comma) +
labs(title="Chicago Libraries Computer Sessions by Geography", x="Longitude", y="Latitude") +
theme(plot.title = element_text(size=16))
)
ggsave(file="Libraries/_System/GeoMapComputer.png", geoplots, height=11, width=8.5, units="in")
# CIRCULATION GEO PLOT
geoplots <- grid.arrange(
ggplot() +
geom_polygon(data=subset(map_data("state"), region=="illinois"), aes(x=long, y=lat, group=group),colour="white", fill="#64b5cd" ) +
geom_polygon(data=neighdf, aes(x=LON, y=LAT, group=neighborhood), colour="white", fill="#64b5cd" ) +
coord_map(xlim = c(-87.9, -87.5),ylim = c(41.65, 42.03)) +
geom_point(data=aggdf, aes(x=LON, y=LAT, size = as.numeric(CIRCULATION)), color="#c44e52") +
geom_text(data=aggdf, hjust=0.5, vjust=-0.5, aes(x=LON, y=LAT, label=LOCATION), colour="steelblue4", size=3) +
scale_size(name="Circulation", label=comma) +
labs(title="Chicago Libraries Circulation by Geography", x="Longitude", y="Latitude") +
theme(plot.title = element_text(size=16, hjust = 0.5))
)
ggsave(file="Libraries/_System/GeoMapCirculation.png", geoplots, height=11, width=8.5, units="in")
# VISITORS GEO PLOT
geoplots <- grid.arrange(
ggplot() +
geom_polygon(data=subset(map_data("state"), region=="illinois"), aes(x=long, y=lat, group=group),colour="white", fill="#64b5cd" ) +
geom_polygon(data=neighdf, aes(x=LON, y=LAT, group=neighborhood), colour="white", fill="#64b5cd" ) +
coord_map(xlim = c(-87.9, -87.5),ylim = c(41.65, 42.03)) +
geom_point(data=aggdf, aes(x=LON, y=LAT, size = as.numeric(VISITORS)), color="#c44e52") +
geom_text(data=aggdf, hjust=0.5, vjust=-0.5, aes(x=LON, y=LAT, label=LOCATION), colour="steelblue4", size=3) +
scale_size(name="Visitors", label=comma) +
labs(title="Chicago Libraries Visitors by Geography", x="Longitude", y="Latitude") +
theme(plot.title = element_text(size=16, hjust = 0.5))
)
ggsave(file="Libraries/_System/GeoMapVisitors.png", geoplots, height=11, width=8.5, units="in")
# HOLDS GEO PLOT
geoplots <- grid.arrange(
ggplot() +
geom_polygon(data=subset(map_data("state"), region=="illinois"), aes(x=long, y=lat, group=group),colour="white", fill="#64b5cd" ) +
geom_polygon(data=neighdf, aes(x=LON, y=LAT, group=neighborhood), colour="white", fill="#64b5cd" ) +
coord_map(xlim = c(-87.9, -87.5),ylim = c(41.65, 42.03)) +
geom_point(data=aggdf, aes(x=LON, y=LAT, size = as.numeric(HOLDS)), color="#c44e52") +
geom_text(data=aggdf, hjust=0.5, vjust=-0.5, aes(x=LON, y=LAT, label=LOCATION), colour="steelblue4", size=3) +
scale_size(name="Holds", label=comma) +
labs(title="Chicago Libraries Holds by Geography", x="Longitude", y="Latitude") +
theme(plot.title = element_text(size=16, hjust = 0.5))
)
ggsave(file="Libraries/_System/GeoMapHolds.png", geoplots, height=11, width=8.5, units="in")
# COMPUTER GEO PLOT
geoplots <- grid.arrange(
ggplot() +
geom_polygon(data=subset(map_data("state"), region=="illinois"), aes(x=long, y=lat, group=group),colour="white", fill="#64b5cd" ) +
geom_polygon(data=neighdf, aes(x=LON, y=LAT, group=neighborhood), colour="white", fill="#64b5cd" ) +
coord_map(xlim = c(-87.9, -87.5),ylim = c(41.65, 42.03)) +
geom_point(data=aggdf, aes(x=LON, y=LAT, size = as.numeric(COMPUTER)), color="#c44e52") +
geom_text(data=aggdf, hjust=0.5, vjust=-0.5, aes(x=LON, y=LAT, label=LOCATION), colour="steelblue4", size=3) +
scale_size(name="CPU Sessions", label=comma) +
labs(title="Chicago Libraries Computer Sessions by Geography", x="Longitude", y="Latitude") +
theme(plot.title = element_text(size=16, hjust = 0.5))
)
ggsave(file="Libraries/_System/GeoMapComputer.png", geoplots, height=11, width=8.5, units="in")
